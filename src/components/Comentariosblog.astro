---
// Componente de Comentarios con Carrusel Infinito
---

<section class="py-16! mb-10! overflow-hidden! bg-[#f0f0f0]! rounded-2xl!">
    <div class="max-w-7xl! mx-auto! px-4! sm:px-6! lg:px-8! mb-10!">
        <div class="text-center!">
            <span class="inline-block! bg-[#B78B1E]! text-white! font-['Montserrat']! font-semibold! text-xs! px-4! py-2! rounded-full! uppercase! tracking-widest! mb-4! shadow-md!">
                Testimonios
            </span>
            <h2 class="font-['EB_Garamond']! text-3xl! sm:text-4xl! md:text-5xl! text-[#007078]! font-bold! mb-4!">
                Lo Que Dicen Nuestros Viajeros
            </h2>
            <p class="font-['Montserrat']! text-lg! text-[#666666]! max-w-2xl! mx-auto! font-medium!">
                Experiencias reales de quienes han confiado en nosotros para crear sus viajes de ensueño
            </p>
        </div>
    </div>

    <!-- Carrusel Container -->
    <div class="relative!">
        <!-- Gradient Overlays -->
        <div class="absolute! left-0! top-0! bottom-0! w-32! bg-linear-to-r! from-[#f0f0f0]! to-transparent! z-10! pointer-events-none!"></div>
        <div class="absolute! right-0! top-0! bottom-0! w-32! bg-linear-to-l! from-[#f0f0f0]! to-transparent! z-10! pointer-events-none!"></div>
        
        <!-- Carrusel de comentarios -->
        <div class="carrusel-wrapper!">
            <div id="carrusel-comentarios" class="carrusel-track! flex! gap-6! animate-scroll-left!">
                <!-- Los comentarios se cargarán aquí -->
            </div>
        </div>
    </div>
</section>

<script is:inline>
    async function cargarComentarios() {
        try {
            const response = await fetch('https://jsonplaceholder.typicode.com/comments');
            const comments = await response.json();
            
            // Tomar solo los primeros 20 comentarios para mejor rendimiento
            const comentariosLimitados = comments.slice(0, 20);
            
            // Generar HTML para cada comentario
            const generarTarjeta = (comment) => `
                <div class="comentario-card! flex-shrink-0! w-80! bg-white! rounded-xl! p-6! shadow-lg! border-l-4! border-[#B78B1E]! hover:shadow-xl! transition-shadow! duration-300!">
                    <div class="flex! items-start! gap-4! mb-4!">
                        <div class="w-12! h-12! rounded-full! bg-gradient-to-br! from-[#007078]! to-[#005a61]! flex! items-center! justify-center! text-white! font-bold! text-lg! shadow-md! flex-shrink-0!">
                            ${comment.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="min-w-0! flex-1!">
                            <h4 class="font-['Montserrat']! font-semibold! text-[#007078]! text-sm! leading-tight! line-clamp-2!">
                                ${comment.name}
                            </h4>
                            <p class="font-['Montserrat']! text-xs! text-[#666666]! truncate! mt-1!">
                                ${comment.email}
                            </p>
                        </div>
                    </div>
                    <div class="relative!">
                        <svg class="absolute! -top-2! -left-1! w-6! h-6! text-[#B78B1E]/20!" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                        </svg>
                        <p class="font-['Montserrat']! text-sm! text-[#333333]! leading-relaxed! line-clamp-4! pl-4!">
                            ${comment.body}
                        </p>
                    </div>
                    <div class="mt-4! pt-4! border-t! border-[#E9E4E3]! flex! items-center! justify-between!">
                        <div class="flex! items-center! gap-1!">
                            ${[1,2,3,4,5].map(() => `
                                <svg class="w-4! h-4! text-[#B78B1E]!" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                </svg>
                            `).join('')}
                        </div>
                        <span class="font-['Montserrat']! text-xs! text-[#666666]! font-medium!">
                            Viaje verificado
                        </span>
                    </div>
                </div>
            `;
            
            // Llenar carrusel (duplicar para loop infinito)
            const carrusel = document.getElementById('carrusel-comentarios');
            const contenido = comentariosLimitados.map(generarTarjeta).join('');
            carrusel.innerHTML = contenido + contenido; // Duplicar para loop infinito
            
            // Iniciar animación con JavaScript
            iniciarAnimacion();
            
        } catch (error) {
            console.error('Error cargando comentarios:', error);
            document.getElementById('carrusel-comentarios').innerHTML = `
                <div class="w-full! text-center! py-8!">
                    <p class="font-['Montserrat']! text-[#666666]!">No se pudieron cargar los comentarios</p>
                </div>
            `;
        }
    }
    
    function iniciarAnimacion() {
        const carrusel = document.getElementById('carrusel-comentarios');
        let posicion = 0;
        const velocidad = 1; // Pixeles por frame
        let animacionActiva = true;
        
        // Obtener el ancho de la mitad del contenido (para loop infinito)
        const anchoMitad = carrusel.scrollWidth / 2;
        
        function animar() {
            if (animacionActiva) {
                posicion += velocidad;
                
                // Resetear posición para loop infinito
                if (posicion >= anchoMitad) {
                    posicion = 0;
                }
                
                carrusel.style.transform = `translateX(-${posicion}px)`;
            }
            requestAnimationFrame(animar);
        }
        
        // Pausar al hacer hover
        carrusel.addEventListener('mouseenter', () => {
            animacionActiva = false;
        });
        
        carrusel.addEventListener('mouseleave', () => {
            animacionActiva = true;
        });
        
        // Iniciar la animación
        requestAnimationFrame(animar);
    }
    
    // Cargar comentarios al iniciar
    cargarComentarios();
</script>

<style>
    .carrusel-wrapper {
        overflow: hidden;
        width: 100%;
    }
    
    .carrusel-track {
        display: flex;
        width: max-content;
        gap: 1.5rem;
    }
    
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .line-clamp-4 {
        display: -webkit-box;
        -webkit-line-clamp: 4;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    /* Responsive */
    @media (max-width: 640px) {
        .comentario-card {
            width: 280px !important;
        }
    }
</style>
